# renamed tasks: to upgrade-sequence:
upgrade-sequence:
  sequential:
    - print: "**** done start upgrade, wait"
    - install.upgrade:
        mon.a
    - ceph.healthy:
    - install.upgrade:
        mon.b
    - ceph.healthy:
    - ceph.restart:
        daemons: [mon.*, mgr.*]
        mon-health-to-clog: false
        wait-for-healthy: false
    - ceph.healthy:
    - ceph.restart:
        daemons: [osd.*]
        wait-for-healthy: false
        wait-for-osds-up: true
    - ceph.stop: [mds.*]
    - ceph.restart:
        daemons: [mds.*]
        wait-for-healthy: false
        wait-for-osds-up: true
    - exec:
        mon.a:
          - ceph osd dump -f json-pretty
          - ceph versions
          - ceph osd require-osd-release squid
          - for f in `ceph osd pool ls` ; do ceph osd pool set $f pg_autoscale_mode off ; done
    - ceph.healthy:
    - print: "**** done end upgrade, wait..."
